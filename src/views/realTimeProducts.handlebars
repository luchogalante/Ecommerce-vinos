<h1>Productos en tiempo real</h1>

<!-- ðŸ”¥ Lista dinÃ¡mica -->
<ul id="productList">
  {{#each products}}
    <li id="product-{{id}}">
      <strong>{{title}}</strong> - ${{price}}
      <button onclick="deleteProduct('{{id}}')">Eliminar</button>
    </li>
  {{/each}}
</ul>

<hr>

<!-- ðŸ“¦ Formulario para agregar producto -->
<h2>Agregar nuevo producto</h2>

<form id="productForm">
  <input type="text" name="title" placeholder="TÃ­tulo" required>
  <input type="text" name="description" placeholder="DescripciÃ³n" required>
  <input type="text" name="code" placeholder="CÃ³digo" required>
  <input type="number" name="price" placeholder="Precio" required>
  <input type="number" name="stock" placeholder="Stock" required>
  <input type="text" name="category" placeholder="CategorÃ­a" required>
  <button type="submit">Agregar</button>
</form>

<hr>
<a href="/">Volver al Home</a>

<!-- âœ… Socket.io + script del cliente -->
<script src="/socket.io/socket.io.js"></script>
<script>
  const socket = io();

  // âœ… Cuando llega un producto nuevo desde el backend
  socket.on("productAdded", (product) => {
    const list = document.getElementById("productList");
    const li = document.createElement("li");
    li.id = `product-${product.id}`;
    li.innerHTML = `<strong>${product.title}</strong> - $${product.price}
                    <button onclick="deleteProduct('${product.id}')">Eliminar</button>`;
    list.appendChild(li);
  });

  // âœ… Cuando se elimina un producto desde backend
  socket.on("productDeleted", (id) => {
    const element = document.getElementById(`product-${id}`);
    if (element) element.remove();
  });

  // âœ… Captura del submit del formulario (POST a /api/products)
  document.getElementById("productForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const formData = new FormData(e.target);
    const data = Object.fromEntries(formData);

    await fetch("/api/products", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });

    e.target.reset(); // limpia formulario
  });

  // âœ… Eliminar producto
  async function deleteProduct(id) {
    await fetch(`/api/products/${id}`, { method: "DELETE" });
  }
</script>
